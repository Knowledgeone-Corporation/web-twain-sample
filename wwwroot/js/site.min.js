function RenderDesktopSelection(){K1WebTwain.GetDevices().then(function(b){for(var d=InitialiseDropDown($("#sel-scanner")),a=0;a<b.length;a++)d.append($("<option />").val(b[a].id).text(b[a].name));$("#sel-scanner").unbind(),$("#device-group").show(),BindAcquire();var c=function(a,b){for(var c in InitialiseDropDown(a),b)a.append($("<option />").val(b[c]).text(c))};c($("#sel-ocr-type"),K1WebTwain.Options.OcrType),c($("#sel-output"),K1WebTwain.Options.OutputFiletype)}).catch(function(a){console.error(a)})}function RenderSelection(){K1WebTwain.GetDevices().then(function(b){$("#device-group").show(),BindAcquire();var a=function(a,b){for(var c in InitialiseDropDown(a),b)a.append($("<option />").val(b[c]).text(c))};a($("#sel-ocr-type"),K1WebTwain.Options.OcrType),a($("#sel-output"),K1WebTwain.Options.OutputFiletype),BindScannerSelection(b)}).catch(function(a){console.error(a)})}function BindAcquire(){$("#btn-acquire").unbind(),$("#btn-acquire").click(function(b){$("#errorMessageDiv").hide();var a={};a.deviceId=$("#sel-scanner").val(),a.resolutionId=$("#sel-dpi").val(),a.pixelTypeId=$("#sel-color").val(),a.filetype=$("#sel-output").val(),a.ocrType=$("#sel-ocr-type").val(),a.filename=$("#sel-output-name").val(),a.pageSizeId=$("#sel-page-size").val(),a.documentSourceId=$("#sel-document-source").val(),a.duplexId=$("#sel-duplex").val(),K1WebTwain.Acquire(a).then(function(a){$(".filename").val(a.filename),$(".filesize").text(a.sizeDisplay),$(".filesize").show(),$(".fileview").show(),$("#uploadResponseOutput").text(JSON.stringify(a.uploadResponse,null,4)),$("#uploadResponseDiv").show()}).catch(function(a){if(console.error(a),a.responseJSON)try{$("#errorMessageOutput").text(JSON.stringify(a.responseJSON,null,4))}catch(b){a.responseText&&$("#errorMessageOutput").text(a.responseText)}a.responseText&&$("#errorMessageOutput").text(a.responseText),$("#errorMessageDiv").show()}),InitialiseInterfaceOption()})}function BindScannerSelection(b){for(var c=InitialiseDropDown($("#sel-scanner")),a=0;a<b.length;a++)c.append($("<option />").val(b[a].id).text(b[a].name));$("#sel-scanner").unbind(),$("#sel-scanner").change(ScannerSelect),ScannerSelect()}function ScannerSelect(){var b=function(a,b){if(InitialiseDropDown(a),jQuery.isEmptyObject(b)){a.parent().hide();return}for(var c in b)a.append($("<option />").val(c).text(b[c]));a.parent().show()},a=$("#sel-scanner").val();a&&K1WebTwain.Device(a).then(function(a){a&&(b($("#sel-color"),{}),b($("#sel-dpi"),{}),b($("#sel-page-size"),{}),b($("#sel-duplex"),{}),BindDocumentSource(a.documentSourceIds))}).catch(function(a){console.error(a);var b=JSON.stringify(a.responseJSON,null,4);$("#errorMessageOutput").text(b),$("#errorMessageDiv").show()})}function BindDocumentSource(a){var b=InitialiseDropDown($("#sel-document-source"));for(var c in a)b.append($("<option />").val(a[c].id).text(a[c].name));b.parent().show(),$("#sel-document-source").unbind(),$("#sel-document-source").change(DocumentSourceSelect),DocumentSourceSelect()}function DocumentSourceSelect(){var b=function(a,b){if(InitialiseDropDown(a),jQuery.isEmptyObject(b)){a.parent().hide();return}for(var c in b)a.append($("<option />").val(c).text(b[c]));a.parent().show()},c=$("#sel-document-source").val();if(c){var d=$("#sel-scanner").val(),a=K1WebTwain.FetchedDevice(d);if(a){var e=a.documentSourceIds[c].pixelTypeIds,f=a.documentSourceIds[c].resolutionIds,g=a.documentSourceIds[c].pageSizeIds,h=a.duplexIds;b($("#sel-color"),e),b($("#sel-dpi"),f),b($("#sel-page-size"),g),b($("#sel-duplex"),h)}}}function InitialiseInterfaceOption(){var a=$("#interface-option-dropdown");a.empty(),a.append("<option disabled selected>Please select...</option>"),a.append("<option value='0'>Hidden : Not using Webtwain or Native UI</option>"),a.append("<option value='1'>Visible : Uses Webtwain and Native UI</option>"),a.append("<option value='2'>Web : only uses Webtwain UI</option>"),a.append("<option value='3'>Desktop : only uses Native scanner UI</option>"),$("#btn-acquire").hide(),$("#scanbtn").hide(),$("#k1interface-visible").addClass("hide"),$("#k1interface-hidden").addClass("hide")}function InitialiseDropDown(a){return a.empty(),a.selectedIndex=0,a}function K1ScanServiceComplete(a){$(".filename").val(a.filename),$(".filesize").text(a.sizeDisplay),$(".filesize").show(),$(".fileview").show(),$("#saveBtn").removeAttr("disabled"),$("#uploadResponseOutput").text(JSON.stringify(a.uploadResponse,null,4)),$("#uploadResponseDiv").show()}function InitialiseToastr(){toastr.options.timeOut=1e4,toastr.options.extendedTimeOut=5e3,toastr.options.progressBar=!0,toastr.options.positionClass="toast-top-center"}$(document).ready(function(){InitialiseToastr(),InitialiseInterfaceOption(),$("#interface-option-dropdown").change(function(a){$("#errorMessageDiv").hide(),$(".twain-feature-group").hide();var b=$(a.target),c=parseInt(b.val()),d={onComplete:K1ScanServiceComplete,viewButton:$(".k1ViewBtn"),fileUploadURL:document.location.origin+"/Home/UploadFile",clientID:$("#ClientID").val(),setupFile:document.location.origin+"/Home/DownloadSetup",interfacePath:"",scannerInterface:c,scanButton:$("#scanbtn")};K1WebTwain.Configure(d).then(function(a){$("#btn-acquire").show(),$("#scanbtn").show(),$(".alert").hide(),$("#k1interface-visible").addClass("hide"),$("#k1interface-hidden").addClass("hide"),K1WebTwain.ResetService().then(function(){setTimeout(()=>{switch(a.scannerInterface){case K1WebTwain.Options.ScannerInterface.Visible:case K1WebTwain.Options.ScannerInterface.Web:$("#k1interface-visible").removeClass("hide"),$("#k1interface-hidden").addClass("hide");break;case K1WebTwain.Options.ScannerInterface.Hidden:RenderSelection(),$("#k1interface-visible").addClass("hide"),$("#k1interface-hidden").removeClass("hide"),$("#sel-output-name").val("ScanFile"+Math.floor(1e4*Math.random()+1e5));break;case K1WebTwain.Options.ScannerInterface.Desktop:RenderDesktopSelection(),$("#k1interface-visible").addClass("hide"),$("#k1interface-hidden").removeClass("hide"),$("#sel-output-name").val("ScanFile"+Math.floor(1e4*Math.random()+1e5))}},4e3)})}).catch(function(a){$("#k1interface-visible").addClass("hide"),$("#k1interface-hidden").addClass("hide"),console.error(a),$("#errorMessageOutput").text(a),$("#errorMessageDiv").show(),K1WebTwain.ResetService()}),$("#scanbtn").click(function(a){InitialiseInterfaceOption()})});var a=$("#SelectedInterface").val();a.length>0&&$("#interface-option-dropdown").val(a).change()})