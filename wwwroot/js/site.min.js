function RenderDesktopSelection(){K1WebTwain.GetDevices().then(function(e){for(var n=InitialiseDropDown($("#sel-scanner")),t=0;t<e.length;t++)n.append($("<option />").val(e[t].id).text(e[t].name));$("#sel-scanner").unbind(),$("#device-group").show(),BindAcquire();var i=function(e,n){for(var t in InitialiseDropDown(e),n)e.append($("<option />").val(n[t]).text(t))};i($("#sel-ocr-type"),K1WebTwain.Options.OcrType),i($("#sel-output"),K1WebTwain.Options.OutputFiletype)}).catch(function(e){console.error(e)})}function RenderSelection(){K1WebTwain.GetDevices().then(function(e){$("#device-group").show(),BindAcquire();var n=function(e,n){for(var t in InitialiseDropDown(e),n)e.append($("<option />").val(n[t]).text(t))};n($("#sel-ocr-type"),K1WebTwain.Options.OcrType),n($("#sel-output"),K1WebTwain.Options.OutputFiletype),BindScannerSelection(e)}).catch(function(e){console.error(e)})}function BindAcquire(){$("#btn-acquire").unbind(),$("#btn-acquire").click(function(e){$("#errorMessageDiv").hide();var n={};n.deviceId=$("#sel-scanner").val(),n.resolutionId=$("#sel-dpi").val(),n.pixelTypeId=$("#sel-color").val(),n.filetype=$("#sel-output").val(),n.ocrType=$("#sel-ocr-type").val(),n.filename=$("#sel-output-name").val(),n.pageSizeId=$("#sel-page-size").val(),n.documentSourceId=$("#sel-document-source").val(),n.documentSoureName=$("#sel-document-source option:selected").text(),n.duplexId=$("#sel-duplex").val(),K1WebTwain.Acquire(n).then(function(e){$(".filename").val(e.filename),$(".filesize").text(e.sizeDisplay),$(".filesize").show(),$(".fileview").show(),$("#uploadResponseOutput").text(JSON.stringify(e.uploadResponse,null,4)),$("#uploadResponseDiv").show(),InitialiseInterfaceOption()}).catch(function(e){if(e){if(e.statusText&&"timeout"===e.statusText&&$("#errorMessageOutput").text("Timeout error while processing/uploading scanned documents."),e.responseJSON)try{$("#errorMessageOutput").text(JSON.stringify(e.responseJSON,null,4))}catch(n){e.responseText&&$("#errorMessageOutput").text(e.responseText)}e.responseText&&$("#errorMessageOutput").text(e.responseText),$("#errorMessageDiv").show(),InitialiseInterfaceOption()}})})}function BindScannerSelection(e){for(var n=InitialiseDropDown($("#sel-scanner")),t=0;t<e.length;t++)n.append($("<option />").val(e[t].id).text(e[t].name));$("#sel-scanner").unbind(),$("#sel-scanner").change(ScannerSelect),ScannerSelect()}function ScannerSelect(){var e=function(e,n){if(InitialiseDropDown(e),jQuery.isEmptyObject(n)){e.parent().hide();return}for(var t in n)e.append($("<option />").val(t).text(n[t]));e.parent().show()},n=$("#sel-scanner").val();n&&K1WebTwain.Device(n).then(function(n){n&&(e($("#sel-color"),{}),e($("#sel-dpi"),{}),e($("#sel-page-size"),{}),e($("#sel-duplex"),{}),BindDocumentSource(n.documentSourceIds))}).catch(function(e){console.error(e);var n=JSON.stringify(e.responseJSON,null,4);$("#errorMessageOutput").text(n),$("#errorMessageDiv").show()})}function BindDocumentSource(e){var n=InitialiseDropDown($("#sel-document-source"));for(var t in e)n.append($("<option />").val(e[t].id).text(e[t].name));n.parent().show(),$("#sel-document-source").unbind(),$("#sel-document-source").change(DocumentSourceSelect),DocumentSourceSelect()}function DocumentSourceSelect(){var e=function(e,n){if(InitialiseDropDown(e),jQuery.isEmptyObject(n)){e.parent().hide();return}for(var t in n)e.append($("<option />").val(t).text(n[t]));e.parent().show()},n=$("#sel-document-source").val();if(n){var t=$("#sel-scanner").val(),i=K1WebTwain.FetchedDevice(t);if(i){var o=i.documentSourceIds[n];e($("#sel-color"),o.pixelTypeIds),e($("#sel-dpi"),o.resolutionIds),e($("#sel-page-size"),o.pageSizeIds),e($("#sel-duplex"),o.duplexIds)}}}function InitialiseInterfaceOption(){var e=$("#interface-option-dropdown");e.empty(),e.append("<option disabled selected>Please select...</option>"),e.append("<option value='0'>Hidden : Not using Webtwain or Native UI</option>"),e.append("<option value='1'>Visible : Uses Webtwain and Native UI</option>"),e.append("<option value='2'>Web : only uses Webtwain UI</option>"),e.append("<option value='3'>Desktop : only uses Native scanner UI</option>"),$("#btn-acquire").hide(),$("#scanbtn").hide(),$("#k1interface-visible").addClass("hide"),$("#k1interface-hidden").addClass("hide")}function InitialiseDropDown(e){return e.empty(),e.selectedIndex=0,e}function K1ScanServiceComplete(e){$(".filename").val(e.filename),$(".filesize").text(e.sizeDisplay),$(".filesize").show(),$(".fileview").show(),$("#saveBtn").removeAttr("disabled"),$("#uploadResponseOutput").text(JSON.stringify(e.uploadResponse,null,4)),$("#uploadResponseDiv").show()}function ShowWait(e,n){e?$(".k1ss-msg").text(e):$(".k1ss-msg").text("Loading, please wait..."),n||(n=!1),!0==n?$(".k1ss-msgbox .k1ss-close").show():$(".k1ss-msgbox .k1ss-close").hide(),$(".k1ss-wait-div").show()}function HideWait(){$(".k1ss-wait-div").hide()}$(document).ready(function(){InitialiseInterfaceOption(),$("#interface-option-dropdown").change(function(e){$("#errorMessageDiv").hide(),$(".twain-feature-group").hide();var n=$(e.target),t=parseInt(n.val()),i={onComplete:K1ScanServiceComplete,viewButton:$(".k1ViewBtn"),fileUploadURL:document.location.origin+"/Home/UploadFile",clientID:$("#ClientID").val(),setupFile:document.location.origin+"/Home/DownloadSetup",interfacePath:"",scannerInterface:t,scanButton:$("#scanbtn")};K1WebTwain.Configure(i).then(function(e){$("#btn-acquire").show(),$("#scanbtn").show(),$(".alert").hide(),$("#k1interface-visible").addClass("hide"),$("#k1interface-hidden").addClass("hide"),K1WebTwain.ResetService().then(function(){ShowWait("Preparing...",!1),setTimeout(()=>{switch(e.scannerInterface){case K1WebTwain.Options.ScannerInterface.Visible:case K1WebTwain.Options.ScannerInterface.Web:$("#k1interface-visible").removeClass("hide"),$("#k1interface-hidden").addClass("hide");break;case K1WebTwain.Options.ScannerInterface.Hidden:RenderSelection(),$("#k1interface-visible").addClass("hide"),$("#k1interface-hidden").removeClass("hide"),$("#sel-output-name").val("ScanFile"+Math.floor(1e4*Math.random()+1e5));break;case K1WebTwain.Options.ScannerInterface.Desktop:RenderDesktopSelection(),$("#k1interface-visible").addClass("hide"),$("#k1interface-hidden").removeClass("hide"),$("#sel-output-name").val("ScanFile"+Math.floor(1e4*Math.random()+1e5))}HideWait()},4e3)})}).catch(function(e){$("#k1interface-visible").addClass("hide"),$("#k1interface-hidden").addClass("hide"),console.error(e),$("#errorMessageOutput").text(e),$("#errorMessageDiv").show(),K1WebTwain.ResetService()}),$("#scanbtn").click(function(e){InitialiseInterfaceOption()})});var e=$("#SelectedInterface").val();e.length>0&&$("#interface-option-dropdown").val(e).change()});